<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <title>Glyphie Chat</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Attachment preview bar */
      #attachment-preview {
        display: none;
        flex-direction: row;
        align-items: center;
        margin: 6px 0 6px 0;
        min-height: 48px;
        overflow-x: auto;
        padding-left: 8px;
        background: var(--background-alt, #1e1e2f);
        border-bottom: 1px solid var(--border-color, #444);
        border-radius: 6px;
      }

      .attachment-chip {
        background: #252835;
        border-radius: 8px;
        display: flex;
        align-items: center;
        border: 1.5px solid var(--accent-color, #3af);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        padding: 2px 6px 2px 2px;
        max-width: 72px;
        cursor: default;
        user-select: none;
        position: relative;
        margin-right: 8px;
        flex-shrink: 0;
      }

      .attachment-thumb {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        object-fit: cover;
        background: #232323;
        display: block;
      }
      .attachment-thumb:focus {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
      }

      .attachment-remove-btn {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: none;
        background: var(--background-alt, #1e1e2f);
        color: var(--accent-color, #f36);
        font-weight: bold;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 6px rgba(255, 54, 90, 0.75);
        transition: background-color 0.25s ease, color 0.25s ease;
        user-select: none;
      }
      .attachment-remove-btn:hover,
      .attachment-remove-btn:focus {
        background-color: var(--accent-color, #f36);
        color: #fff;
        outline: none;
      }

      /* Chat input row adjustments */
      .chat .chat-panel .chat-input-row {
        display: flex;
        flex-direction: column;
      }
      .chat .chat-panel .chat-input-row > .chat-input-group {
        display: flex;
        align-items: flex-end;
        gap: 8px;
      }

      /* Textarea */
      #chat-input {
        flex-grow: 1;
        min-height: 36px;
        max-height: 120px;
        resize: none;
        overflow-y: auto;
        line-height: 1.3;
        font-family: inherit;
        font-size: 1rem;
        padding: 14px 20px;
        border-radius: 18px;
        border: 2.5px solid var(--button-bg);
        background: var(--background-color);
        color: var(--text-color);
        outline-offset: 3px;
        transition: box-shadow 0.25s ease;
      }
      #chat-input:focus {
        box-shadow: 0 0 8px var(--accent-color);
        outline: none;
      }

      #chat-send-btn {
        background: var(--button-bg);
        color: var(--text-color);
        border: none;
        border-radius: 18px;
        padding: 10px 18px;
        font-size: 1rem;
        cursor: pointer;
        flex-shrink: 0;
        transition: background-color 0.25s ease;
      }
      #chat-send-btn:hover,
      #chat-send-btn:focus {
        background-color: var(--accent-color);
        color: #000;
        outline: none;
      }

      /* Timestamp */
      .msg-time {
        font-size: 0.75em;
        color: #888;
        margin-top: 3px;
        text-align: right;
        user-select: none;
      }

      /* Chat bubbles */
      .message {
        margin: 8px 12px;
        padding: 8px 12px;
        border-radius: 12px;
        max-width: 70%;
        word-wrap: break-word;
        position: relative;
        font-size: 1rem;
        line-height: 1.4;
      }
      .message.user {
        background-color: var(--button-bg);
        color: var(--text-color);
        margin-left: auto;
        text-align: left;
      }
      .message.bot {
        background-color: var(--background-alt, #2c2e3e);
        color: #ccc;
        margin-right: auto;
        text-align: left;
      }
      .message.error {
        background-color: #4f1e1e;
        color: #f88;
        border-left: 4px solid #f44;
      }
      .message.typing {
        font-style: italic;
        opacity: 0.7;
      }

      /* Modal for attachment full preview */
      #attachment-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(20, 24, 33, 0.95);
        justify-content: center;
        align-items: center;
        z-index: 9999;
        outline: none;
      }
      #attachment-modal.show {
        display: flex;
      }
      #attachment-modal img {
        max-width: 90vw;
        max-height: 85vh;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
      }
      #attachment-modal #attachment-modal-close {
        position: absolute;
        top: 20px;
        right: 32px;
        background-color: #f44;
        border: none;
        color: white;
        font-weight: bold;
        font-size: 24px;
        width: 44px;
        height: 44px;
        border-radius: 22px;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
        transition: background-color 0.25s ease;
      }
      #attachment-modal #attachment-modal-close:hover,
      #attachment-modal #attachment-modal-close:focus {
        background-color: #ff6666;
        outline: none;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="wrapper">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" role="navigation" aria-label="Main navigation">
          <div class="logo" aria-label="Glyphie logo">Glyphie</div>
          <button
            class="nav-btn active"
            data-section="characters"
            title="Characters"
            aria-pressed="true"
            role="tab"
            tabindex="0"
          >
            <span>üëæ</span>
            <span class="label">Agents</span>
          </button>
          <button
            class="nav-btn"
            data-section="snip"
            title="Snip Tool"
            aria-pressed="false"
            role="tab"
            tabindex="-1"
          >
            <span>‚úÇÔ∏è</span>
            <span class="label">Snip</span>
          </button>
          <button
            class="nav-btn"
            data-section="settings"
            title="Settings"
            aria-pressed="false"
            role="tab"
            tabindex="-1"
          >
            <span>‚öôÔ∏è</span>
            <span class="label">Settings</span>
          </button>
          <button
            class="nav-btn"
            data-section="stats"
            title="Usage Stats"
            aria-pressed="false"
            role="tab"
            tabindex="-1"
          >
            <span>üìä</span>
            <span class="label">Usage</span>
          </button>
        </nav>

        <!-- Main Content -->
        <main
          id="main-content"
          role="main"
          aria-live="polite"
          aria-relevant="additions removals"
          tabindex="0"
        >
          <section id="characters-section" class="content-section"></section>

          <section id="snip-section" class="content-section hidden">
            <div class="chat-panel">
              <div class="chat-header" aria-label="Snip mode header">
                <span>Snip Mode ‚úÇÔ∏è</span>
              </div>
              <div id="snip-chat-history" class="chat-history"></div>
              <div class="chat-input-row">
                <button id="snip-btn" title="Start a new snip">Snip ‚úÇÔ∏è</button>
                <input
                  id="snip-chat-input"
                  type="text"
                  placeholder="Add a message (optional)..."
                  autocomplete="off"
                />
                <button id="snip-send-btn">Send</button>
              </div>
            </div>
          </section>

          <section id="stats-section" class="content-section hidden"></section>

          <section id="settings-section" class="content-section hidden">
            <h2>Settings panel coming soon!</h2>
            <div class="appearance-section">
              <h3>Appearance</h3>
              <div class="setting-item">
                <label class="toggle-label" for="toggle-theme"
                  >üåó Dark Mode:</label
                >
                <input id="toggle-theme" class="toggle-input" type="checkbox" />
                <span class="custom-slider"></span>
              </div>
            </div>
          </section>

          <!-- Active chat panel -->
          <div class="chat-panel">
            <div class="chat-header" aria-label="Chat header" role="banner">
              <img
                class="chat-avatar"
                alt="Agent avatar"
                id="chat-agent-avatar"
                src="avatars/white.png"
              />
              <span id="chat-agent-name" class="chat-agent-name"
                >Select an agent</span
              >
            </div>

            <div
              id="chat-history"
              class="chat-history"
              aria-live="polite"
            ></div>

            <!-- Toolbar with Attach & Regenerate -->
            <div class="chat-toolbar" role="region" aria-label="Chat toolbar">
              <button
                id="toolbar-attach-btn"
                aria-label="Attach files"
                title="Attach files"
                type="button"
              >
                üìé
              </button>
              <button
                id="toolbar-regenerate-btn"
                aria-label="Regenerate response"
                title="Regenerate response"
                type="button"
              >
                ‚ü≥
              </button>
            </div>

            <!-- Attachment Preview Bar -->
            <div id="attachment-preview"></div>

            <!-- Input row: textarea and send button -->
            <div class="chat-input-row">
              <div class="chat-input-group">
                <textarea
                  id="chat-input"
                  autocomplete="off"
                  placeholder="Ask or enter a prompt"
                  rows="1"
                  aria-multiline="true"
                  spellcheck="false"
                ></textarea>
                <button
                  id="chat-send-btn"
                  aria-label="Send message"
                  type="button"
                >
                  Send
                </button>
              </div>
            </div>
          </div>

          <!-- Attachment preview modal -->
          <div
            id="attachment-modal"
            class="attachment-modal"
            role="dialog"
            aria-modal="true"
            aria-hidden="true"
            tabindex="-1"
          >
            <button
              id="attachment-modal-close"
              aria-label="Close attachment preview"
              title="Close"
              type="button"
            >
              √ó
            </button>
            <img id="attachment-modal-img" alt="Attachment preview" />
          </div>
        </main>
      </div>

      <div id="main-content-overlay"></div>
      <button
        id="sidebar-toggle"
        aria-label="Toggle sidebar"
        title="Toggle sidebar"
      >
        ‚ò∞
      </button>
    </div>
    <script src="popup.js"></script>
  </body>
</html>
